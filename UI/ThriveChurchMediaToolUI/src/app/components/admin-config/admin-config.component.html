<div class="config-container">
  <!-- Header -->
  <div class="config-header">
    <div class="header-content">
      <div class="header-icon">
        <i class="fas fa-cogs"></i>
      </div>
      <div class="header-text">
        <h1>Configuration Management</h1>
        <p>Manage application configuration settings</p>
      </div>
    </div>
    <button
      type="button"
      class="btn-add-config"
      (click)="startAddConfig()"
      [disabled]="formState.isAdding || formState.isEditing">
      <i class="fas fa-plus"></i>
      Add Configuration
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-section">
    <div class="config-skeleton" *ngFor="let i of [1, 2, 3, 4, 5, 6, 7, 8]">
      <div class="skeleton-item"></div>
    </div>
  </div>

  <!-- Add Configuration Form -->
  <div *ngIf="!isLoading && formState.isAdding && !formState.editingKey" class="config-form-card">
    <div class="form-header">
      <h3>Add New Configuration</h3>
      <button class="btn-close" (click)="cancelForm()" [disabled]="isSaving">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="form-body">
      <div class="form-row">
        <div class="form-group">
          <label for="add-key">Key</label>
          <input
            type="text"
            class="form-control"
            [class.is-invalid]="formErrors['key']"
            id="add-key"
            [(ngModel)]="formState.formKey"
            placeholder="e.g., Email_Main, Phone_Main"
            [disabled]="isSaving">
          <div *ngIf="formErrors['key']" class="error-message">
            {{ formErrors['key'] }}
          </div>
        </div>
        <div class="form-group">
          <label for="add-type">Type</label>
          <select
            class="form-control"
            id="add-type"
            [(ngModel)]="formState.formType"
            [disabled]="isSaving">
            <option [ngValue]="0">Phone</option>
            <option [ngValue]="1">Email</option>
            <option [ngValue]="2">Link</option>
            <option [ngValue]="3">Miscellaneous</option>
            <option [ngValue]="4">Social Media</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="add-value">Value</label>
        <input
          type="text"
          class="form-control"
          [class.is-invalid]="formErrors['value']"
          id="add-value"
          [(ngModel)]="formState.formValue"
          placeholder="Enter configuration value"
          [disabled]="isSaving">
        <div *ngIf="formErrors['value']" class="error-message">
          {{ formErrors['value'] }}
        </div>
      </div>
    </div>
    <div class="form-actions">
      <button
        type="button"
        class="btn-save"
        (click)="saveConfig()"
        [disabled]="isSaving">
        <span *ngIf="!isSaving">
          <i class="fas fa-check"></i>
          Save Configuration
        </span>
        <span *ngIf="isSaving">
          <span class="spinner-border spinner-border-sm"></span>
          Saving...
        </span>
      </button>
      <button
        type="button"
        class="btn-cancel"
        (click)="cancelForm()"
        [disabled]="isSaving">
        Cancel
      </button>
    </div>
  </div>

  <!-- Configuration List -->
  <div *ngIf="!isLoading" class="config-list">
    <div *ngFor="let config of allConfigs" class="config-item" [class.editing]="isConfigBeingEdited(config.Key)">
      <!-- View Mode -->
      <div *ngIf="!isConfigBeingEdited(config.Key)" class="config-view">
        <div class="config-icon">
          <i class="fas {{ getConfigIcon(config.Type) }}"></i>
        </div>
        <div class="config-content">
          <div class="config-meta">
            <span class="config-key">{{ config.Key }}</span>
            <span class="config-type-badge">{{ getConfigTypeName(config.Type) }}</span>
          </div>
          <div class="config-value">{{ config.Value }}</div>
        </div>
        <div class="config-actions">
          <button
            class="btn-icon btn-edit"
            (click)="startEdit(config)"
            [disabled]="formState.isEditing || formState.isAdding"
            title="Edit">
            <i class="fas fa-edit"></i>
          </button>
          <button
            class="btn-icon btn-delete"
            (click)="confirmDelete(config.Key)"
            [disabled]="formState.isEditing || formState.isAdding || deleteConfirmKey !== null"
            title="Delete">
            <i class="fas fa-trash-alt"></i>
          </button>
        </div>
      </div>

      <!-- Edit Mode -->
      <div *ngIf="isConfigBeingEdited(config.Key)" class="config-edit">
        <div class="config-icon">
          <i class="fas {{ getConfigIcon(config.Type) }}"></i>
        </div>
        <div class="config-form-inline">
          <div class="form-group-inline">
            <label>Key</label>
            <input
              type="text"
              class="form-control-inline"
              [(ngModel)]="formState.formKey"
              disabled
              readonly>
          </div>
          <div class="form-group-inline">
            <label>Value</label>
            <input
              type="text"
              class="form-control-inline"
              [class.is-invalid]="formErrors['value']"
              [(ngModel)]="formState.formValue"
              placeholder="Enter configuration value"
              [disabled]="isSaving">
            <div *ngIf="formErrors['value']" class="error-message">
              {{ formErrors['value'] }}
            </div>
          </div>
        </div>
        <div class="config-actions">
          <button
            class="btn-icon btn-save"
            (click)="saveConfig()"
            [disabled]="isSaving"
            title="Save">
            <span *ngIf="!isSaving">
              <i class="fas fa-check"></i>
            </span>
            <span *ngIf="isSaving">
              <span class="spinner-border spinner-border-sm"></span>
            </span>
          </button>
          <button
            class="btn-icon btn-cancel"
            (click)="cancelForm()"
            [disabled]="isSaving"
            title="Cancel">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <!-- Delete Confirmation -->
      <div *ngIf="deleteConfirmKey === config.Key" class="config-delete-confirm">
        <div class="delete-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="delete-content">
          <div class="delete-message">
            <strong>Delete this configuration?</strong>
            <p>This action cannot be undone.</p>
          </div>
        </div>
        <div class="delete-actions">
          <button
            class="btn-icon btn-confirm-delete"
            (click)="deleteConfig(config.Key)"
            [disabled]="isDeleting"
            title="Confirm Delete">
            <span *ngIf="!isDeleting">
              <i class="fas fa-trash-alt"></i>
            </span>
            <span *ngIf="isDeleting">
              <span class="spinner-border spinner-border-sm"></span>
            </span>
          </button>
          <button
            class="btn-icon btn-cancel"
            (click)="cancelDelete()"
            [disabled]="isDeleting"
            title="Cancel">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="allConfigs.length === 0" class="empty-state">
      <i class="fas fa-inbox"></i>
      <h3>No Configurations Found</h3>
      <p>Click "Add Configuration" to create your first setting.</p>
    </div>
  </div>
</div>

